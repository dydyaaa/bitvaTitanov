# Docker Setup –¥–ª—è Chat API

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker
- Docker Compose
- NVIDIA Docker (–¥–ª—è CUDA –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ PyTorch)

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
git clone <repository>
cd bitvaTitanov
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç A: –° GPU –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π (CUDA)
```bash
docker-compose up --build
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –¢–æ–ª—å–∫–æ CPU (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å NVIDIA CUDA –æ–±—Ä–∞–∑–æ–º)
```bash
docker-compose -f docker-compose.cpu.yaml up --build
```

### 3. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: http://localhost:3000
- **–ë–µ–∫–µ–Ω–¥ API**: http://localhost:8000
- **API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: localhost:5432

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

### Backend (FastAPI)
- **–ü–æ—Ä—Ç**: 8000
- **–û–±—Ä–∞–∑**: –°–æ–±—Ä–∞–Ω–Ω—ã–π –∏–∑ `backend/Dockerfile`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: 
  - CUDA –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è PyTorch (Ubuntu 24.04 + Python 3.12)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch 2.6.0+cu124
  - –ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤ development —Ä–µ–∂–∏–º–µ

### Frontend (React + Vite)
- **–ü–æ—Ä—Ç**: 3000 (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ 5173)
- **–û–±—Ä–∞–∑**: –°–æ–±—Ä–∞–Ω–Ω—ã–π –∏–∑ `Frontend/Dockerfile`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Vite dev —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
  - –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑ nginx
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### Database (PostgreSQL)
- **–ü–æ—Ä—Ç**: 5432
- **–û–±—Ä–∞–∑**: postgres:15
- **–î–∞–Ω–Ω—ã–µ**: –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ volume

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
```bash
docker-compose up -d
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f db
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose down
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
```bash
docker-compose build --no-cache
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```bash
# –ë–µ–∫–µ–Ω–¥
docker-compose exec backend bash

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec db psql -U postgres -d chatdb
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
- **–ë–µ–∫–µ–Ω–¥**: –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume, –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: Vite dev —Å–µ—Ä–≤–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∫–µ–Ω–¥–∞
docker-compose exec backend bash

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å CUDA
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å CUDA –æ–±—Ä–∞–∑–æ–º (`nvidia/cuda:12.4-devel-ubuntu22.04: not found`):

#### –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU –≤–µ—Ä—Å–∏—é
```bash
docker-compose -f docker-compose.cpu.yaml up --build
```

#### –†–µ—à–µ–Ω–∏–µ 2: –û–±–Ω–æ–≤–∏—Ç–µ –æ–±—Ä–∞–∑ CUDA
–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `backend/Dockerfile`:
```dockerfile
FROM nvidia/cuda:12.1-devel-ubuntu22.04  # –≤–º–µ—Å—Ç–æ 12.4
```

#### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ NVIDIA Docker
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω NVIDIA Docker
2. –î—Ä–∞–π–≤–µ—Ä—ã NVIDIA –∞–∫—Ç—É–∞–ª—å–Ω—ã
3. Docker –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ GPU

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–∞–º–∏
–ï—Å–ª–∏ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã, –∏–∑–º–µ–Ω–∏—Ç–µ –∏—Ö –≤ `docker-compose.yaml`:
```yaml
ports:
  - "8001:8000"  # –ë–µ–∫–µ–Ω–¥ –Ω–∞ 8001
  - "3001:5173"  # –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ 3001
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes
docker-compose down -v

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã –ø—Ä–æ–µ–∫—Ç–∞
docker-compose down --rmi all
```

<small>–ú–æ–∂–Ω–æ –Ω–∞–º —Ö–æ—Ç—è –±—ã –∫–æ–º–±–æ –∏–∑ –∫—Ñ—Å? üëâüëà</small>
